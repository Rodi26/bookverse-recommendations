============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-8.3.2, pluggy-1.6.0 -- /Library/Developer/CommandLineTools/usr/bin/python3
cachedir: .pytest_cache
rootdir: /Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core
configfile: pytest.ini
plugins: asyncio-1.2.0, anyio-4.10.0, cov-6.2.1
asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 29 items

tests/integration/test_demo_app.py::TestDemoAppBasic::test_demo_info_endpoint PASSED [  3%]
tests/integration/test_demo_app.py::TestDemoAppBasic::test_demo_summary_endpoint PASSED [  6%]
tests/integration/test_demo_app.py::TestDemoAppBasic::test_public_auth_endpoint PASSED [ 10%]
tests/integration/test_demo_app.py::TestDemoAppBasic::test_config_current_endpoint FAILED [ 13%]
tests/integration/test_demo_app.py::TestDemoAppBasic::test_logging_demo_endpoint PASSED [ 17%]
tests/integration/test_demo_app.py::TestDemoAppBasic::test_validation_demo_endpoint PASSED [ 20%]
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_default FAILED [ 24%]
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_custom_params PASSED [ 27%]
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_with_filter PASSED [ 31%]
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_invalid_params PASSED [ 34%]
tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_optional_auth_no_token PASSED [ 37%]
tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_optional_auth_with_token ERROR [ 41%]
tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_protected_endpoint_no_token FAILED [ 44%]
tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_protected_endpoint_with_token ERROR [ 48%]
tests/integration/test_demo_app.py::TestDemoAppCRUD::test_create_item_no_auth FAILED [ 51%]
tests/integration/test_demo_app.py::TestDemoAppCRUD::test_create_item_with_auth ERROR [ 55%]
tests/integration/test_demo_app.py::TestDemoAppCRUD::test_create_item_validation_error ERROR [ 58%]
tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_request_id_header PASSED [ 62%]
tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_cors_headers PASSED [ 65%]
tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_middleware_demo_endpoint PASSED [ 68%]
tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_error_handling_demo FAILED [ 72%]
tests/integration/test_demo_app.py::TestDemoAppHealth::test_basic_health_check FAILED [ 75%]
tests/integration/test_demo_app.py::TestDemoAppHealth::test_liveness_probe FAILED [ 79%]
tests/integration/test_demo_app.py::TestDemoAppHealth::test_readiness_probe FAILED [ 82%]
tests/integration/test_demo_app.py::TestDemoAppHealth::test_detailed_health_demo PASSED [ 86%]
tests/integration/test_demo_app.py::TestDemoAppResponses::test_response_patterns_demo PASSED [ 89%]
tests/integration/test_demo_app.py::TestDemoAppResponses::test_standard_info_endpoint PASSED [ 93%]
tests/integration/test_demo_app.py::TestDemoAppIntegration::test_complete_demo_workflow PASSED [ 96%]
tests/integration/test_demo_app.py::TestDemoAppIntegration::test_authenticated_workflow ERROR [100%]

==================================== ERRORS ====================================
__ ERROR at setup of TestDemoAppAuthentication.test_optional_auth_with_token ___
../../../../Library/Python/3.9/lib/python/site-packages/pytest_asyncio/plugin.py:733: in pytest_fixture_setup
    return (yield)
tests/conftest.py:89: in mock_auth_user
    return AuthUser(
E   TypeError: __init__() got an unexpected keyword argument 'user_id'
_ ERROR at setup of TestDemoAppAuthentication.test_protected_endpoint_with_token _
../../../../Library/Python/3.9/lib/python/site-packages/pytest_asyncio/plugin.py:733: in pytest_fixture_setup
    return (yield)
tests/conftest.py:89: in mock_auth_user
    return AuthUser(
E   TypeError: __init__() got an unexpected keyword argument 'user_id'
_________ ERROR at setup of TestDemoAppCRUD.test_create_item_with_auth _________
../../../../Library/Python/3.9/lib/python/site-packages/pytest_asyncio/plugin.py:733: in pytest_fixture_setup
    return (yield)
tests/conftest.py:89: in mock_auth_user
    return AuthUser(
E   TypeError: __init__() got an unexpected keyword argument 'user_id'
_____ ERROR at setup of TestDemoAppCRUD.test_create_item_validation_error ______
../../../../Library/Python/3.9/lib/python/site-packages/pytest_asyncio/plugin.py:733: in pytest_fixture_setup
    return (yield)
tests/conftest.py:89: in mock_auth_user
    return AuthUser(
E   TypeError: __init__() got an unexpected keyword argument 'user_id'
_____ ERROR at setup of TestDemoAppIntegration.test_authenticated_workflow _____
../../../../Library/Python/3.9/lib/python/site-packages/pytest_asyncio/plugin.py:733: in pytest_fixture_setup
    return (yield)
tests/conftest.py:89: in mock_auth_user
    return AuthUser(
E   TypeError: __init__() got an unexpected keyword argument 'user_id'
=================================== FAILURES ===================================
________________ TestDemoAppBasic.test_config_current_endpoint _________________
tests/integration/test_demo_app.py:71: in test_config_current_endpoint
    assert config["database_url"] == "***"
E   AssertionError: assert 's***********...************b' == '***'
E     
E     - ***
E     + s********************************b
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:58,999 - bookverse_core.api.middleware - INFO - 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/config/current', 'client_ip': 'testclient', 'user_agent': 'testclient'}
[bookverse-core-demo] 2025-09-13 13:18:58,999 - main - INFO - ⚙️ Configuration endpoint accessed
[bookverse-core-demo] 2025-09-13 13:18:59,001 - bookverse_core.api.middleware - INFO - 📤 Response: {'request_id': 'unknown', 'status_code': 200, 'duration_ms': 1.77}
[bookverse-core-demo] 2025-09-13 13:18:59,002 - httpx - INFO - HTTP Request: GET http://testserver/demo/config/current "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     bookverse_core.api.middleware:middleware.py:145 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/config/current', 'client_ip': 'testclient', 'user_agent': 'testclient'}
INFO     main:main.py:194 ⚙️ Configuration endpoint accessed
INFO     bookverse_core.api.middleware:middleware.py:179 📤 Response: {'request_id': 'unknown', 'status_code': 200, 'duration_ms': 1.77}
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/demo/config/current "HTTP/1.1 200 OK"
________________ TestDemoAppPagination.test_pagination_default _________________
tests/integration/test_demo_app.py:118: in test_pagination_default
    assert pagination["per_page"] == 10
E   assert 20 == 10
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,082 - bookverse_core.api.middleware - INFO - 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/pagination/items', 'client_ip': 'testclient', 'user_agent': 'testclient'}
[bookverse-core-demo] 2025-09-13 13:18:59,085 - api.demo_endpoints - INFO - 📄 Pagination demo: page 1, per_page 20
[bookverse-core-demo] 2025-09-13 13:18:59,086 - bookverse_core.api.middleware - INFO - 📤 Response: {'request_id': 'unknown', 'status_code': 200, 'duration_ms': 4.39}
[bookverse-core-demo] 2025-09-13 13:18:59,089 - httpx - INFO - HTTP Request: GET http://testserver/demo/pagination/items "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     bookverse_core.api.middleware:middleware.py:145 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/pagination/items', 'client_ip': 'testclient', 'user_agent': 'testclient'}
INFO     api.demo_endpoints:demo_endpoints.py:63 📄 Pagination demo: page 1, per_page 20
INFO     bookverse_core.api.middleware:middleware.py:179 📤 Response: {'request_id': 'unknown', 'status_code': 200, 'duration_ms': 4.39}
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/demo/pagination/items "HTTP/1.1 200 OK"
__________ TestDemoAppAuthentication.test_protected_endpoint_no_token __________
tests/integration/test_demo_app.py:190: in test_protected_endpoint_no_token
    assert data["success"] is False
E   KeyError: 'success'
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,154 - bookverse_core.api.middleware - INFO - 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/auth/protected', 'client_ip': 'testclient', 'user_agent': 'testclient'}
[bookverse-core-demo] 2025-09-13 13:18:59,155 - bookverse_core.api.middleware - WARNING - ⚠️ Response: {'request_id': 'unknown', 'status_code': 401, 'duration_ms': 1.3}
[bookverse-core-demo] 2025-09-13 13:18:59,156 - httpx - INFO - HTTP Request: GET http://testserver/demo/auth/protected "HTTP/1.1 401 Unauthorized"
------------------------------ Captured log call -------------------------------
INFO     bookverse_core.api.middleware:middleware.py:145 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/auth/protected', 'client_ip': 'testclient', 'user_agent': 'testclient'}
WARNING  bookverse_core.api.middleware:middleware.py:179 ⚠️ Response: {'request_id': 'unknown', 'status_code': 401, 'duration_ms': 1.3}
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/demo/auth/protected "HTTP/1.1 401 Unauthorized"
___________________ TestDemoAppCRUD.test_create_item_no_auth ___________________
tests/integration/test_demo_app.py:224: in test_create_item_no_auth
    assert data["success"] is False
E   KeyError: 'success'
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,201 - bookverse_core.api.middleware - INFO - 📥 Request: {'request_id': 'unknown', 'method': 'POST', 'url': 'http://testserver/demo/items', 'client_ip': 'testclient', 'user_agent': 'testclient'}
[bookverse-core-demo] 2025-09-13 13:18:59,202 - bookverse_core.api.middleware - WARNING - ⚠️ Response: {'request_id': 'unknown', 'status_code': 401, 'duration_ms': 1.47}
[bookverse-core-demo] 2025-09-13 13:18:59,203 - httpx - INFO - HTTP Request: POST http://testserver/demo/items "HTTP/1.1 401 Unauthorized"
------------------------------ Captured log call -------------------------------
INFO     bookverse_core.api.middleware:middleware.py:145 📥 Request: {'request_id': 'unknown', 'method': 'POST', 'url': 'http://testserver/demo/items', 'client_ip': 'testclient', 'user_agent': 'testclient'}
WARNING  bookverse_core.api.middleware:middleware.py:179 ⚠️ Response: {'request_id': 'unknown', 'status_code': 401, 'duration_ms': 1.47}
INFO     httpx:_client.py:1026 HTTP Request: POST http://testserver/demo/items "HTTP/1.1 401 Unauthorized"
________________ TestDemoAppMiddleware.test_error_handling_demo ________________
  + Exception Group Traceback (most recent call last):
  |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 87, in collapse_excgroups
  |     yield
  |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 193, in __call__
  |     response_sent.set()
  |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 341, in from_call
    |     result: TResult | None = func()
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 242, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/threadexception.py", line 92, in pytest_runtest_call
    |     yield from thread_exception_runtest_hook()
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/threadexception.py", line 68, in thread_exception_runtest_hook
    |     yield
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/unraisableexception.py", line 95, in pytest_runtest_call
    |     yield from unraisable_exception_runtest_hook()
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/unraisableexception.py", line 70, in unraisable_exception_runtest_hook
    |     yield
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/logging.py", line 848, in pytest_runtest_call
    |     yield from self._runtest_for(item, "call")
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/logging.py", line 831, in _runtest_for
    |     yield
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/capture.py", line 879, in pytest_runtest_call
    |     return (yield)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/skipping.py", line 257, in pytest_runtest_call
    |     return (yield)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 174, in pytest_runtest_call
    |     item.runtest()
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 1627, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 159, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/tests/integration/test_demo_app.py", line 313, in test_error_handling_demo
    |     response = demo_app_client.get("/demo/error/demo?simulate_error=true")
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 548, in get
    |     return super().get(
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 1054, in get
    |     return self.request(
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 516, in request
    |     return super().request(
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 827, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 1015, in _send_single_request
    |     response = transport.handle_request(request)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 398, in handle_request
    |     raise exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 395, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py", line 291, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 445, in result
    |     return self.__get_result()
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 390, in __get_result
    |     raise self._exception
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py", line 222, in _call_func
    |     retval = await retval_or_awaitable
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 123, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response_sent.set()
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    |     self.gen.throw(type, value, traceback)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    |     raise exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |   File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/auth/middleware.py", line 109, in dispatch
    |     return await call_next(request)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 165, in call_next
    |     raise app_exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 151, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response_sent.set()
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    |     self.gen.throw(type, value, traceback)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    |     raise exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |   File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py", line 149, in dispatch
    |     response = await call_next(request)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 165, in call_next
    |     raise app_exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 151, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 193, in __call__
    |     response_sent.set()
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    |     self.gen.throw(type, value, traceback)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    |     raise exc
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 191, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |   File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py", line 244, in dispatch
    |     return JSONResponse(
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/responses.py", line 184, in __init__
    |     super().__init__(content, status_code, headers, media_type, background)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/responses.py", line 41, in __init__
    |     self.body = self.render(content)
    |   File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/responses.py", line 187, in render
    |     return json.dumps(
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/__init__.py", line 234, in dumps
    |     return cls(
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/encoder.py", line 199, in encode
    |     chunks = self.iterencode(o, _one_shot=True)
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/encoder.py", line 257, in iterencode
    |     return _iterencode(o, 0)
    |   File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/encoder.py", line 179, in default
    |     raise TypeError(f'Object of type {o.__class__.__name__} '
    | TypeError: Object of type datetime is not JSON serializable
    +------------------------------------

During handling of the above exception, another exception occurred:
tests/integration/test_demo_app.py:313: in test_error_handling_demo
    response = demo_app_client.get("/demo/error/demo?simulate_error=true")
../../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:548: in get
    return super().get(
../../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1054: in get
    return self.request(
../../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:516: in request
    return super().request(
../../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:827: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
../../../../Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1015: in _send_single_request
    response = transport.handle_request(request)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:398: in handle_request
    raise exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:395: in handle_request
    portal.call(self.app, scope, receive, send)
../../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:291: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../../Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:222: in _call_func
    retval = await retval_or_awaitable
../../../../Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/applications.py:123: in __call__
    await self.middleware_stack(scope, receive, send)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:193: in __call__
    response_sent.set()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:135: in __exit__
    self.gen.throw(type, value, traceback)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/_utils.py:93: in collapse_excgroups
    raise exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:191: in __call__
    response = await self.dispatch_func(request, call_next)
bookverse_core/auth/middleware.py:109: in dispatch
    return await call_next(request)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:165: in call_next
    raise app_exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:151: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:193: in __call__
    response_sent.set()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:135: in __exit__
    self.gen.throw(type, value, traceback)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/_utils.py:93: in collapse_excgroups
    raise exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:191: in __call__
    response = await self.dispatch_func(request, call_next)
bookverse_core/api/middleware.py:149: in dispatch
    response = await call_next(request)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:165: in call_next
    raise app_exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:151: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:193: in __call__
    response_sent.set()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:135: in __exit__
    self.gen.throw(type, value, traceback)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/_utils.py:93: in collapse_excgroups
    raise exc
../../../../Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:191: in __call__
    response = await self.dispatch_func(request, call_next)
bookverse_core/api/middleware.py:244: in dispatch
    return JSONResponse(
../../../../Library/Python/3.9/lib/python/site-packages/starlette/responses.py:184: in __init__
    super().__init__(content, status_code, headers, media_type, background)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/responses.py:41: in __init__
    self.body = self.render(content)
../../../../Library/Python/3.9/lib/python/site-packages/starlette/responses.py:187: in render
    return json.dumps(
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/__init__.py:234: in dumps
    return cls(
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/encoder.py:199: in encode
    chunks = self.iterencode(o, _one_shot=True)
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/encoder.py:257: in iterencode
    return _iterencode(o, 0)
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/json/encoder.py:179: in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
E   TypeError: Object of type datetime is not JSON serializable
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,252 - bookverse_core.api.middleware - INFO - 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/error/demo', 'client_ip': 'testclient', 'user_agent': 'testclient'}
[bookverse-core-demo] 2025-09-13 13:18:59,252 - api.demo_endpoints - INFO - ❌ Error handling demo: simulate_error=False
[bookverse-core-demo] 2025-09-13 13:18:59,253 - bookverse_core.api.middleware - INFO - 📤 Response: {'request_id': 'unknown', 'status_code': 200, 'duration_ms': 1.28}
[bookverse-core-demo] 2025-09-13 13:18:59,254 - httpx - INFO - HTTP Request: GET http://testserver/demo/error/demo "HTTP/1.1 200 OK"
[bookverse-core-demo] 2025-09-13 13:18:59,255 - bookverse_core.api.middleware - INFO - 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/error/demo?simulate_error=true', 'client_ip': 'testclient', 'user_agent': 'testclient'}
[bookverse-core-demo] 2025-09-13 13:18:59,255 - api.demo_endpoints - INFO - ❌ Error handling demo: simulate_error=True
[bookverse-core-demo] 2025-09-13 13:18:59,255 - bookverse_core.api.middleware - ERROR - ❌ Unhandled exception in request bde43c7a-bcda-4a8b-9aab-8a2a5ae07e35: ValueError: This is a simulated error for demonstration purposes
Traceback (most recent call last):
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 159, in call_next
    message = await recv_stream.receive()
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py", line 214, in dispatch
    return await call_next(request)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 165, in call_next
    raise app_exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 193, in __call__
    response_sent.set()
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    raise exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
  File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py", line 67, in dispatch
    response = await call_next(request)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 165, in call_next
    raise app_exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 776, in app
    await route.handle(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 72, in app
    response = await func(request)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 278, in app
    raw_response = await run_endpoint_function(
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/tests/../app/api/demo_endpoints.py", line 185, in error_handling_demo
    raise ValueError("This is a simulated error for demonstration purposes")
ValueError: This is a simulated error for demonstration purposes
[bookverse-core-demo] 2025-09-13 13:18:59,265 - bookverse_core.api.middleware - ERROR - ❌ Request failed: unknown GET /demo/error/demo - TypeError: Object of type datetime is not JSON serializable (0.010s)
------------------------------ Captured log call -------------------------------
INFO     bookverse_core.api.middleware:middleware.py:145 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/error/demo', 'client_ip': 'testclient', 'user_agent': 'testclient'}
INFO     api.demo_endpoints:demo_endpoints.py:180 ❌ Error handling demo: simulate_error=False
INFO     bookverse_core.api.middleware:middleware.py:179 📤 Response: {'request_id': 'unknown', 'status_code': 200, 'duration_ms': 1.28}
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/demo/error/demo "HTTP/1.1 200 OK"
INFO     bookverse_core.api.middleware:middleware.py:145 📥 Request: {'request_id': 'unknown', 'method': 'GET', 'url': 'http://testserver/demo/error/demo?simulate_error=true', 'client_ip': 'testclient', 'user_agent': 'testclient'}
INFO     api.demo_endpoints:demo_endpoints.py:180 ❌ Error handling demo: simulate_error=True
ERROR    bookverse_core.api.middleware:middleware.py:222 ❌ Unhandled exception in request bde43c7a-bcda-4a8b-9aab-8a2a5ae07e35: ValueError: This is a simulated error for demonstration purposes
Traceback (most recent call last):
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 159, in call_next
    message = await recv_stream.receive()
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py", line 214, in dispatch
    return await call_next(request)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 165, in call_next
    raise app_exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 193, in __call__
    response_sent.set()
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 93, in collapse_excgroups
    raise exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
  File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py", line 67, in dispatch
    response = await call_next(request)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 165, in call_next
    raise app_exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 776, in app
    await route.handle(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 72, in app
    response = await func(request)
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 278, in app
    raw_response = await run_endpoint_function(
  File "/Users/yonatanp/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "/Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/tests/../app/api/demo_endpoints.py", line 185, in error_handling_demo
    raise ValueError("This is a simulated error for demonstration purposes")
ValueError: This is a simulated error for demonstration purposes
ERROR    bookverse_core.api.middleware:middleware.py:153 ❌ Request failed: unknown GET /demo/error/demo - TypeError: Object of type datetime is not JSON serializable (0.010s)
__________________ TestDemoAppHealth.test_basic_health_check ___________________
tests/integration/test_demo_app.py:331: in test_basic_health_check
    assert data["status"] == "healthy"
E   AssertionError: assert 'degraded' == 'healthy'
E     
E     - healthy
E     + degraded
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,853 - bookverse_core.auth.oidc - WARNING - ⚠️ OIDC configuration unavailable in demo mode: HTTPSConnectionPool(host='dev-auth.bookverse.com', port=443): Max retries exceeded with url: /.well-known/openid_configuration (Caused by NameResolutionError("<urllib3.connection.HTTPSConnection object at 0x106d50190>: Failed to resolve 'dev-auth.bookverse.com' ([Errno 8] nodename nor servname provided, or not known)"))
[bookverse-core-demo] 2025-09-13 13:18:59,853 - bookverse_core.auth.health - WARNING - ⚠️ Authentication service unavailable in demo mode: 503: Authentication service unavailable (expected in demo mode)
[bookverse-core-demo] 2025-09-13 13:18:59,855 - httpx - INFO - HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
WARNING  bookverse_core.auth.oidc:oidc.py:54 ⚠️ OIDC configuration unavailable in demo mode: HTTPSConnectionPool(host='dev-auth.bookverse.com', port=443): Max retries exceeded with url: /.well-known/openid_configuration (Caused by NameResolutionError("<urllib3.connection.HTTPSConnection object at 0x106d50190>: Failed to resolve 'dev-auth.bookverse.com' ([Errno 8] nodename nor servname provided, or not known)"))
WARNING  bookverse_core.auth.health:health.py:66 ⚠️ Authentication service unavailable in demo mode: 503: Authentication service unavailable (expected in demo mode)
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
____________________ TestDemoAppHealth.test_liveness_probe _____________________
tests/integration/test_demo_app.py:343: in test_liveness_probe
    assert data["status"] == "healthy"
E   AssertionError: assert 'alive' == 'healthy'
E     
E     - healthy
E     + alive
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,888 - httpx - INFO - HTTP Request: GET http://testserver/health/live "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health/live "HTTP/1.1 200 OK"
____________________ TestDemoAppHealth.test_readiness_probe ____________________
tests/integration/test_demo_app.py:352: in test_readiness_probe
    assert data["status"] == "healthy"
E   AssertionError: assert 'ready' == 'healthy'
E     
E     - healthy
E     + ready
----------------------------- Captured stdout call -----------------------------
[bookverse-core-demo] 2025-09-13 13:18:59,898 - httpx - INFO - HTTP Request: GET http://testserver/health/ready "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health/ready "HTTP/1.1 200 OK"
=============================== warnings summary ===============================
../../../../Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35
  /Users/yonatanp/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
    warnings.warn(

tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_default
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_custom_params
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_with_filter
tests/integration/test_demo_app.py::TestDemoAppIntegration::test_complete_demo_workflow
  /Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/tests/../app/api/demo_endpoints.py:84: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    **paginated_response.dict(),

tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_default
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_custom_params
tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_with_filter
tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_error_handling_demo
tests/integration/test_demo_app.py::TestDemoAppResponses::test_response_patterns_demo
tests/integration/test_demo_app.py::TestDemoAppResponses::test_response_patterns_demo
tests/integration/test_demo_app.py::TestDemoAppIntegration::test_complete_demo_workflow
  /Users/yonatanp/Library/Python/3.9/lib/python/site-packages/pydantic/main.py:979: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn('The `dict` method is deprecated; use `model_dump` instead.', DeprecationWarning)

tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_error_handling_demo
  /Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/bookverse_core/api/middleware.py:246: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    content=error_response.dict()

tests/integration/test_demo_app.py::TestDemoAppResponses::test_response_patterns_demo
  /Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/tests/../app/api/demo_endpoints.py:217: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    "success_response": success_example.dict(),

tests/integration/test_demo_app.py::TestDemoAppResponses::test_response_patterns_demo
  /Users/yonatanp/playground/AppTrust-BookVerse/bookverse-demo/bookverse-core/tests/../app/api/demo_endpoints.py:218: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    "error_response": error_example.dict(),

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/integration/test_demo_app.py::TestDemoAppBasic::test_config_current_endpoint
FAILED tests/integration/test_demo_app.py::TestDemoAppPagination::test_pagination_default
FAILED tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_protected_endpoint_no_token
FAILED tests/integration/test_demo_app.py::TestDemoAppCRUD::test_create_item_no_auth
FAILED tests/integration/test_demo_app.py::TestDemoAppMiddleware::test_error_handling_demo
FAILED tests/integration/test_demo_app.py::TestDemoAppHealth::test_basic_health_check
FAILED tests/integration/test_demo_app.py::TestDemoAppHealth::test_liveness_probe
FAILED tests/integration/test_demo_app.py::TestDemoAppHealth::test_readiness_probe
ERROR tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_optional_auth_with_token
ERROR tests/integration/test_demo_app.py::TestDemoAppAuthentication::test_protected_endpoint_with_token
ERROR tests/integration/test_demo_app.py::TestDemoAppCRUD::test_create_item_with_auth
ERROR tests/integration/test_demo_app.py::TestDemoAppCRUD::test_create_item_validation_error
ERROR tests/integration/test_demo_app.py::TestDemoAppIntegration::test_authenticated_workflow
============= 8 failed, 16 passed, 15 warnings, 5 errors in 1.05s ==============

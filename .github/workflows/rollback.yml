name: Rollback

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Recommendations version to rollback (SemVer)"
        required: true

jobs:
  rollback:
    name: Rollback
    runs-on: ubuntu-latest
    env:
      JFROG_URL: ${{ vars.JFROG_URL }}
      JFROG_ADMIN_TOKEN: ${{ secrets.JFROG_ADMIN_TOKEN }}
    steps:
      - name: "[Setup] Checkout"
        uses: actions/checkout@v4

      - name: "[Setup] AppTrust context"
        run: |
          BASE="${JFROG_URL%/}"
          echo "APPTRUST_BASE_URL=${BASE}/apptrust/api/v1" >> $GITHUB_ENV
          echo "APPTRUST_ACCESS_TOKEN=${JFROG_ADMIN_TOKEN}" >> $GITHUB_ENV

      - name: "[Setup] Python"
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: "[Rollback] Execute"
        run: |
          python scripts/apptrust_rollback.py \
            --version "${{ github.event.inputs.version }}" \
            --base-url "$APPTRUST_BASE_URL" \
            --token "$APPTRUST_ACCESS_TOKEN"


